<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Panel HTML Previewer</title>
    <!-- Memuat Tailwind CSS untuk styling modern dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter */
        html { font-family: 'Inter', sans-serif; }
        
        /* FIX KRITIS: Memastikan latar belakang body berwarna gelap agar tidak putih di lingkungan terisolasi */
        body {
            background-color: #1f2937 !important; 
        }

        /* Keyframes untuk animasi berputar */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Style dasar untuk Iframe */
        .preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
            transition: all 0.3s ease;
        }

        /* Style untuk mode fullscreen/perbesar */
        #preview-area.is-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            /* Tinggi dikurangi tinggi kontrol fullscreen di atas */
            height: calc(100vh - 80px); 
            padding: 0.75rem;
            margin-top: 80px; /* Jarak dari kontrol di atas */
            z-index: 50; 
            background-color: #1f2937; 
            transition: all 0.5s ease-in-out;
            /* Selalu 2 kolom saat fullscreen */
            grid-template-columns: repeat(2, 1fr) !important; 
            grid-auto-rows: 1fr; 
            gap: 1rem; 
        }
        
        #preview-area.is-fullscreen .preview-card {
             /* Tinggi 50% dikurangi padding/gap saat fullscreen */
             height: 100%;
        }

        /* Style untuk border pratinjau */
        .preview-card {
            border: 2px solid #4b5563; 
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            background-color: #374151; 
            display: flex;
            flex-direction: column;
            position: relative; /* Untuk penempatan overlay */
        }
        
        /* Overlay Loading */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(31, 41, 55, 0.95); /* dark-bg semi-transparan */
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: #10b981; /* secondary color */
            font-weight: bold;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        /* Tata Letak Mobile (selalu 2 kolom) - Tinggi minimum yang lebih baik */
        #preview-area {
            grid-template-columns: repeat(2, 1fr); 
            gap: 0.75rem; 
            grid-auto-rows: minmax(300px, 1fr); 
            padding: 0.75rem; 
        }

        /* Menyembunyikan elemen lain saat mode zoom individu aktif */
        .hidden-during-zoom {
            display: none !important;
        }


        /* Responsive height control for desktop/tablet */
        @media (min-width: 1024px) {
            #preview-area {
                gap: 1.5rem; 
                grid-auto-rows: minmax(350px, 1fr); 
            }
            .preview-card {
                /* Tinggi di desktop/tablet yang proporsional */
                height: calc(50vh - 4.5rem); 
            }
        }
    </style>
    <script>
        // Konfigurasi Tailwind untuk warna dan font
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#4f46e5',
                        'secondary': '#10b981',
                        'dark-bg': '#1f2937',
                        'card-bg': '#374151',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-dark-bg text-gray-100 min-h-screen p-4 sm:p-8">

    <!-- Header (Disembunyikan saat fullscreen) -->
    <header class="text-center mb-8" id="main-header">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-primary">Pratinjau Kode HTML Multi-Panel</h1>
        <p class="mt-2 text-gray-400">Pilih jumlah panel dan beri nama pratinjau Anda.</p>
    </header>
    
    <!-- Fullscreen Controls (Disembunyikan secara default, hanya muncul saat fullscreen) -->
    <section id="fullscreen-controls" class="hidden fixed top-0 left-0 w-full h-20 p-4 bg-gray-900 z-50 shadow-2xl justify-center space-x-4 items-center">
        <button id="fullscreen-refresh" onclick="refreshAllPreviews()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 flex items-center space-x-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.176 10a2.5 2.5 0 01-1.4 1.4A2.5 2.5 0 0118.01 20.91a2.5 2.5 0 01-1.4-1.4m-12.87 0a8.002 8.002 0 01-.06-11.233L10 9m0 0l4.5 4.5m-4.5-4.5v5m-5-5l-4.5 4.5"></path></svg>
            <span id="fs-refresh-text">Refresh Semua</span>
        </button>
        <button onclick="toggleFullScreen()" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
            Kembali ke Mode Normal
        </button>
    </section>

    <!-- KONTROL & UPLOAD AREA (Ini akan disembunyikan saat fullscreen) -->
    <div class="max-w-7xl mx-auto" id="controls-wrapper">
        
        <!-- Kontrol Utama: Pilih Jumlah Panel & Aksi Global -->
        <section class="mb-8 p-4 bg-card-bg rounded-xl shadow-lg flex flex-col items-center justify-between space-y-4">
            
            <!-- Baris 1: Kontrol Jumlah Panel & Fullscreen -->
            <div class="flex flex-col md:flex-row items-center justify-between w-full space-y-4 md:space-y-0 md:space-x-4">
                <div class="flex items-center space-x-4 w-full md:w-auto justify-center md:justify-start">
                    <label for="preview-count" class="font-semibold text-lg whitespace-nowrap">Jumlah Panel:</label>
                    <select id="preview-count" class="bg-gray-700 text-white p-2 rounded-md shadow focus:ring-primary focus:border-primary" onchange="initializeUI()">
                        <option value="1">1 Preview (Default)</option>
                        <option value="2">2 Preview</option>
                        <option value="3">3 Preview</option>
                        <option value="4">4 Preview (Maks)</option>
                    </select>
                </div>

                <button id="fullscreen-toggle" onclick="toggleFullScreen()" class="w-full md:w-auto bg-primary hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md">
                    <span id="fullscreen-text">Mode Perbesar Semua</span>
                </button>
            </div>
            
            <!-- Baris 2: Tombol Refresh Semua (di tengah) -->
            <div class="w-full flex justify-center pt-2 border-t border-gray-700 mt-4">
                <button id="main-refresh" onclick="refreshAllPreviews()" class="w-full md:w-1/2 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow-md flex items-center justify-center space-x-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.176 10a2.5 2.5 0 01-1.4 1.4A2.5 2.5 0 0118.01 20.91a2.5 2.5 0 01-1.4-1.4m-12.87 0a8.002 8.002 0 01-.06-11.233L10 9m0 0l4.5 4.5m-4.5-4.5v5m-5-5l-4.5 4.5"></path></svg>
                    <span id="main-refresh-text">Refresh Semua Pratinjau</span>
                </button>
            </div>
        </section>

        <!-- Area Unggahan File -->
        <section id="upload-area" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8"></section>

    </div>
    <!-- AKHIR KONTROL & UPLOAD AREA -->

    <!-- AREA PRATINJAU (Selalu terlihat, diubah ukurannya saat fullscreen) -->
    <section id="preview-area" class="max-w-7xl mx-auto transition-all duration-500"></section>

    <script>
        // Variabel global
        const previewCountSelect = document.getElementById('preview-count');
        const uploadArea = document.getElementById('upload-area');
        const previewArea = document.getElementById('preview-area');
        const fullscreenText = document.getElementById('fullscreen-text');
        const fullscreenControls = document.getElementById('fullscreen-controls');
        const mainHeader = document.getElementById('main-header');
        const controlsWrapper = document.getElementById('controls-wrapper'); // Menggantikan mainContent
        const mainRefreshButton = document.getElementById('main-refresh');
        const fullscreenRefreshButton = document.getElementById('fullscreen-refresh');
        const bodyElement = document.body; 
        
        let isRefreshing = false; 
        const loadedHtmlContents = {}; 
        
        // --- LOGIKA UTAMA ---

        /**
         * Menginisialisasi UI berdasarkan jumlah panel yang dipilih.
         */
        function initializeUI() {
            const count = parseInt(previewCountSelect.value, 10);
            
            // 1. Bersihkan area sebelumnya
            uploadArea.innerHTML = '';
            previewArea.innerHTML = '';
            
            // 2. Atur tata letak area pratinjau (selalu 2 kolom)
            previewArea.className = `grid grid-cols-2 lg:grid-cols-2 gap-4 p-4 bg-gray-800 rounded-xl transition-all duration-500`;
            
            // Atur jumlah baris
            if (count > 0 && count < 3) {
                previewArea.classList.add('grid-rows-1');
                previewArea.classList.remove('grid-rows-2');
            } else if (count >= 3) {
                previewArea.classList.add('grid-rows-2');
                previewArea.classList.remove('grid-rows-1');
            }

            // 3. Buat input file dan iframe untuk setiap panel
            for (let i = 1; i <= 4; i++) {
                const isVisible = i <= count;
                const defaultTitle = loadedHtmlContents[i] && loadedHtmlContents[i].title ? loadedHtmlContents[i].title : `Preview #${i}`;

                // Buat Input File dan Title Input
                const fileInputContainer = document.createElement('div');
                fileInputContainer.id = `upload-slot-${i}`;
                fileInputContainer.className = `p-3 bg-card-bg rounded-lg border border-gray-600 shadow-md ${isVisible ? '' : 'hidden'}`;
                fileInputContainer.innerHTML = `
                    <label for="title-input-${i}" class="block text-sm font-medium text-gray-300 mb-1">
                        Nama Pratinjau ${i}:
                    </label>
                    <input type="text" id="title-input-${i}" placeholder="${defaultTitle}" 
                           value="${defaultTitle.startsWith('Preview #') ? '' : defaultTitle}"
                           oninput="updatePreviewTitle(${i}, this.value)"
                           class="w-full mb-3 p-2 rounded-md bg-gray-700 text-white border border-gray-600 focus:border-primary focus:ring-primary">
                    
                    <label for="file-input-${i}" class="block text-sm font-medium text-gray-300 mb-2">
                        Upload File HTML:
                    </label>
                    <input type="file" id="file-input-${i}" accept=".html" 
                           class="w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 
                                  file:rounded-full file:border-0 file:text-sm file:font-semibold 
                                  file:bg-primary file:text-white hover:file:bg-indigo-600 cursor-pointer" 
                           onchange="handleFileUpload(event, ${i})">
                `;
                controlsWrapper.querySelector('#upload-area').appendChild(fileInputContainer); // Memastikan upload area berada di dalam controlsWrapper

                // Buat Iframe Preview Card
                const previewCard = document.createElement('div');
                previewCard.id = `preview-card-${i}`;
                previewCard.className = `preview-card ${isVisible ? '' : 'hidden'}`; 
                previewCard.innerHTML = `
                    <div id="loading-overlay-${i}" class="loading-overlay hidden">
                        <svg class="loading-spinner w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.176 10a2.5 2.5 0 01-1.4 1.4A2.5 2.5 0 0118.01 20.91a2.5 2.5 0 01-1.4-1.4m-12.87 0a8.002 8.002 0 01-.06-11.233L10 9m0 0l4.5 4.5m-4.5-4.5v5m-5-5l-4.5 4.5"></path></svg>
                        <span class="mt-2 text-base">Memuat Ulang...</span>
                    </div>
                    <div class="p-2 bg-gray-700 text-sm font-semibold border-b border-gray-600 flex justify-between items-center">
                        <span id="preview-title-${i}">${defaultTitle}</span>
                        <button onclick="zoomSinglePreview(${i})" class="text-xs text-secondary hover:text-emerald-400 transition-colors">
                            <span id="zoom-text-${i}">Perbesar</span>
                        </button>
                    </div>
                    <iframe id="preview-${i}" class="preview-iframe" title="${defaultTitle}"></iframe>
                `;
                previewArea.appendChild(previewCard);
                
                // Muat ulang konten jika sudah ada
                if (loadedHtmlContents[i] && loadedHtmlContents[i].content) {
                    renderHtmlContent(loadedHtmlContents[i].content, i);
                }
            }

            // Atur status tampilan normal saat inisialisasi
            previewArea.classList.remove('is-fullscreen');
            fullscreenControls.classList.add('hidden');
            mainHeader.classList.remove('hidden');
            controlsWrapper.classList.remove('hidden'); // Memastikan controlsWrapper terlihat
            fullscreenText.textContent = 'Mode Perbesar Semua';
        }

        /**
         * Memperbarui judul pratinjau.
         */
        function updatePreviewTitle(id, newTitle) {
            const titleElement = document.getElementById(`preview-title-${id}`);
            const titleToDisplay = newTitle.trim() === '' ? `Preview #${id}` : newTitle.trim();
            
            titleElement.textContent = titleToDisplay;
            document.getElementById(`preview-${id}`).title = titleToDisplay;

            if (!loadedHtmlContents[id]) {
                loadedHtmlContents[id] = {};
            }
            loadedHtmlContents[id].title = titleToDisplay;
        }

        /**
         * Menulis konten HTML ke dalam iframe.
         */
        function renderHtmlContent(htmlContent, id) {
             const iframe = document.getElementById(`preview-${id}`);
             if (iframe) {
                 // Gunakan URL data baru untuk memicu refresh
                 iframe.src = 'data:text/html;charset=utf-8,' + encodeURIComponent(htmlContent);
             }
        }
        
        /**
         * Membaca file yang diunggah dan merendernya.
         */
        function handleFileUpload(event, id) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();

            reader.onload = function(e) {
                const htmlContent = e.target.result;
                
                const currentTitle = loadedHtmlContents[id] && loadedHtmlContents[id].title ? loadedHtmlContents[id].title : `Preview #${id}`;

                loadedHtmlContents[id] = {
                    content: htmlContent, 
                    title: currentTitle 
                };
                renderHtmlContent(htmlContent, id);
            };

            reader.readAsText(file);
        }
        
        /**
         * MELAKUKAN REFRESH SEMUA IFRAME DENGAN JEDA 3 DETIK (BERSAMAAN).
         */
        async function refreshAllPreviews() {
            if (isRefreshing) return; 

            const count = parseInt(previewCountSelect.value, 10);
            let activePreviews = [];
            
            for (let i = 1; i <= count; i++) {
                if (loadedHtmlContents[i] && loadedHtmlContents[i].content) {
                    activePreviews.push(i);
                }
            }

            if (activePreviews.length === 0) {
                console.log(`Tidak ada pratinjau yang dimuat untuk di-refresh.`);
                return;
            }

            isRefreshing = true;
            
            // 1. Nonaktifkan tombol dan update teks
            const buttons = [mainRefreshButton, fullscreenRefreshButton];
            buttons.forEach(btn => {
                if (btn) {
                    btn.disabled = true;
                    btn.querySelector('span').textContent = 'Refreshing (3s delay)...';
                }
            });
            
            // 2. Tampilkan overlay loading di SEMUA panel aktif
            activePreviews.forEach(i => {
                const overlay = document.getElementById(`loading-overlay-${i}`);
                if (overlay) overlay.classList.remove('hidden');
            });

            // 3. TUNGGU 3 DETIK (DELAY)
            console.log("Menunggu 3 detik sebelum me-refresh semua...");
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            // 4. LAKUKAN REFRESH SEMUA SECARA BERSAMAAN
            activePreviews.forEach(i => {
                renderHtmlContent(loadedHtmlContents[i].content, i);
            });

            // 5. Sembunyikan overlay loading
            activePreviews.forEach(i => {
                const overlay = document.getElementById(`loading-overlay-${i}`);
                if (overlay) overlay.classList.add('hidden');
            });

            // 6. Aktifkan kembali tombol dan reset teks
            buttons.forEach(btn => {
                if (btn) {
                    btn.disabled = false;
                }
            });
            document.getElementById('main-refresh-text').textContent = 'Refresh Semua Pratinjau';
            document.getElementById('fs-refresh-text').textContent = 'Refresh Semua';
            
            isRefreshing = false;
            console.log(`Berhasil me-refresh ${activePreviews.length} pratinjau secara bersamaan.`);
        }

        /**
         * Mengaktifkan/menonaktifkan mode fullscreen untuk semua panel pratinjau.
         */
        function toggleFullScreen() {
            const isFullscreen = !previewArea.classList.contains('is-fullscreen');
            
            // Perbarui kelas elemen
            previewArea.classList.toggle('is-fullscreen', isFullscreen);

            // Tampilkan/Sembunyikan kontrol fullscreen
            fullscreenControls.classList.toggle('flex', isFullscreen);
            fullscreenControls.classList.toggle('hidden', !isFullscreen);
            
            // Sembunyikan/Tampilkan header dan WRAPPER KONTROL (controlsWrapper)
            const shouldHide = isFullscreen; 
            mainHeader.classList.toggle('hidden', shouldHide);
            controlsWrapper.classList.toggle('hidden', shouldHide); 

            // Tambahkan/Hapus kelas untuk menyembunyikan scrollbar di body saat fullscreen
            bodyElement.style.overflow = isFullscreen ? 'hidden' : '';

            // Perbarui teks tombol di main content
            fullscreenText.textContent = isFullscreen ? 'Kecilkan Kembali' : 'Mode Perbesar Semua';
            
            // Pastikan tidak ada zoom individu yang aktif
             if (activeZoomId) {
                zoomSinglePreview(activeZoomId);
            }
        }

        /**
         * Mengaktifkan mode fullscreen/perbesar untuk satu panel pratinjau.
         */
        let activeZoomId = null;

        function zoomSinglePreview(id) {
            const card = document.getElementById(`preview-card-${id}`);
            const zoomText = document.getElementById(`zoom-text-${id}`);
            
            // Cek apakah mode fullscreen global sedang aktif, jika iya, jangan izinkan zoom individu
            if (previewArea.classList.contains('is-fullscreen')) {
                 console.log("Nonaktifkan zoom individu saat Mode Perbesar Semua aktif.");
                 return;
            }

            if (activeZoomId && activeZoomId !== id) {
                zoomSinglePreview(activeZoomId); 
            }

            const isZoomed = card.classList.toggle('fixed');
            
            if (isZoomed) {
                // Sembunyikan overlay jika ada
                const overlay = document.getElementById(`loading-overlay-${id}`);
                if (overlay) overlay.classList.add('hidden');

                card.classList.add('inset-0', 'w-full', 'h-full', 'z-40', 'p-4', 'm-0', 'bg-dark-bg', 'flex');
                
                for (let i = 1; i <= 4; i++) {
                    const otherCard = document.getElementById(`preview-card-${i}`);
                    if (i !== id && otherCard && !otherCard.classList.contains('hidden')) {
                         otherCard.classList.add('hidden-during-zoom');
                    }
                }
                
                zoomText.textContent = 'Kecilkan';
                activeZoomId = id;
                bodyElement.style.overflow = 'hidden'; // Sembunyikan scrollbar
            } else {
                card.classList.remove('fixed', 'inset-0', 'w-full', 'h-full', 'z-40', 'p-4', 'm-0', 'bg-dark-bg', 'flex');
                
                for (let i = 1; i <= 4; i++) {
                    const otherCard = document.getElementById(`preview-card-${i}`);
                    if (otherCard) {
                         otherCard.classList.remove('hidden-during-zoom');
                    }
                }
                
                zoomText.textContent = 'Perbesar';
                activeZoomId = null;
                bodyElement.style.overflow = ''; // Tampilkan kembali scrollbar
            }
        }

        // Panggil inisialisasi saat halaman dimuat (default 1 panel)
        document.addEventListener('DOMContentLoaded', initializeUI);
    </script>

</body>
</html>

