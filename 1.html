<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Preview Playground (Android, no filename, delete fix)</title>
<style>
:root{--text:#e5e7eb;--accent:#ef4444;--ring:#22d3ee;}
*{box-sizing:border-box;margin:0;padding:0}
body{background:#0b0f19;color:var(--text);font-family:system-ui,Segoe UI,Roboto,Inter,sans-serif}
.app{max-width:1200px;margin:24px auto;padding:0 16px}
.topbar{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.title{font-weight:700;font-size:18px;flex:1}
.btn{border:none;border-radius:12px;padding:10px 14px;font-weight:600;cursor:pointer;color:#fff;background:var(--accent)}
.btn.add{background:#22c55e}

.grid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap:20px;
}

.card{
  background:#111827;border:1px solid #1e293b;border-radius:14px;
  overflow:hidden;position:relative;transition:.2s;
}

.card-header{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid #1e293b}
.name{font-weight:600;cursor:pointer}
.zoom{background:#1e293b;border:none;color:#cbd5e1;padding:5px 9px;border-radius:8px;cursor:pointer}

.surface{
  background:#fff;min-height:240px;
  display:flex;align-items:center;justify-content:center;
  position:relative;text-align:center;cursor:pointer;
  z-index:0;
}
.surface iframe{position:absolute;inset:0;width:100%;height:100%;border:0}
.surface.empty{outline:2px dashed #cbd5e1; outline-offset:-8px}
.surface.empty .hint{color:#1e293b;font-weight:700;font-size:15px;text-shadow:0 0 4px #fff; padding:16px}

.hold-ring{
  position:absolute;bottom:8px;right:8px;width:38px;height:38px;border-radius:50%;
  border:2px solid #475569;display:flex;align-items:center;justify-content:center;
  font-size:11px;color:#94a3b8;background:#0b1220a6;backdrop-filter:blur(3px);
  z-index:2; cursor:pointer; user-select:none; -webkit-user-select:none; touch-action:manipulation;
}
.hold-ring:active{transform:scale(0.98)}

.overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;place-items:center;z-index:50}
.overlay.active{display:grid}
.spinner{width:60px;height:60px;border-radius:50%;border:5px solid rgba(255,255,255,.2);border-top-color:#fff;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

.focus{position:fixed;inset:0;background:#0b0f19;display:none;z-index:60;padding:16px}
.focus.active{display:block}
.focus-inner{max-width:1100px;margin:auto;height:100%;display:flex;flex-direction:column}
.focus-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.x{background:#1e293b;border:none;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer}
.focus-stage{flex:1;background:#fff;border-radius:10px;overflow:hidden}
.focus-stage iframe{width:100%;height:100%;border:0}

/* Input file jangan display:none supaya mobile ngizinin picker */
.hidden-file-input{
  position:absolute; left:-9999px; width:1px; height:1px; opacity:0;
}
</style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="title">Preview Playground</div>
      <button id="addPreview" class="btn add">＋</button>
      <button id="refreshAll" class="btn">Refresh All</button>
    </div>
    <div id="grid" class="grid"></div>
  </div>

  <div id="overlay" class="overlay"><div class="spinner"></div></div>

  <div id="focus" class="focus">
    <div class="focus-inner">
      <div class="focus-top">
        <div id="focusName" class="name"></div>
        <button id="closeFocus" class="x">✕</button>
      </div>
      <div class="focus-stage"><iframe id="focusFrame" referrerpolicy="no-referrer"></iframe></div>
    </div>
  </div>

  <!-- Input file -->
  <input
    id="filePicker"
    type="file"
    accept=".html,text/html"
    class="hidden-file-input"
    aria-label="Pilih file HTML"
  />

<script>
let cards=[{key:crypto.randomUUID(),name:'Preview #1',html:'',deleted:false}];
const maxCards=10;
const grid=document.getElementById('grid');
const overlay=document.getElementById('overlay');
const filePicker=document.getElementById('filePicker');
const focus={root:document.getElementById('focus'),name:document.getElementById('focusName'),frame:document.getElementById('focusFrame'),close:document.getElementById('closeFocus')};
let pendingKey=null;

function render(){
  grid.innerHTML='';
  const active=cards.filter(c=>!c.deleted);

  active.forEach((card)=>{
    const el=document.createElement('div');
    el.className='card'; el.dataset.key=card.key;

    // header
    const head=document.createElement('div');
    head.className='card-header';

    const nm=document.createElement('div');
    nm.className='name';
    nm.textContent=card.name;
    nm.onclick=()=>{const n=prompt('Rename preview:',nm.textContent); if(n!==null){card.name=n.trim()||card.name; render();}};

    const zoom=document.createElement('button');
    zoom.className='zoom';
    zoom.textContent='Expand';
    zoom.onclick=()=>enterFocus(card.key);

    head.append(nm,zoom);

    // surface
    let surface;
    if(!card.html){
      // Pakai <label> supaya tap membuka picker di Android
      surface=document.createElement('label');
      surface.className='surface empty';
      surface.setAttribute('for','filePicker');
      surface.title='Ketuk untuk pilih file .html (ubah ke "Semua file" jika tidak terlihat)';

      const hint=document.createElement('div');
      hint.className='hint';
      hint.innerHTML='Ketuk untuk pilih file HTML<br/><small>(Kalau nggak muncul, ubah ke <b>Semua file</b> di picker)</small>';
      surface.appendChild(hint);

      surface.addEventListener('click', ()=>{
        pendingKey=card.key;
        if (typeof filePicker.showPicker === 'function') {
          try { filePicker.showPicker(); } catch(e) {}
        }
      }, { passive:true });

    } else {
      surface=document.createElement('div');
      surface.className='surface';
      const iframe=document.createElement('iframe');
      iframe.referrerPolicy='no-referrer';
      iframe.srcdoc=card.html;
      surface.appendChild(iframe);
    }

    // tombol hapus (tap + confirm)
    const ring=document.createElement('div');
    ring.className='hold-ring';
    ring.textContent='delete';
    ring.setAttribute('role','button');
    ring.setAttribute('aria-label','Delete preview');
    ring.tabIndex=0;

    const doDelete=()=>{
      if(confirm('Hapus preview ini?')){
        removeCard(card.key);
      }
    };
    ring.addEventListener('click', (e)=>{ e.stopPropagation(); doDelete(); });
    ring.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' || e.key===' '){ e.preventDefault(); doDelete(); }
    });

    el.append(head,surface,ring);
    grid.appendChild(el);
  });

  // Jika total preview = 3 → preview ke-3 melebar
  const items=[...grid.querySelectorAll('.card')];
  if(items.length===3){ items[2].style.gridColumn='span 2'; }
}

function removeCard(key){
  const i=cards.findIndex(c=>c.key===key);
  if(i!==-1){ cards[i].deleted=true; render(); }
}

function enterFocus(key){
  const c=cards.find(x=>x.key===key && !x.deleted);
  if(!c) return;
  focus.name.textContent=c.name;
  focus.frame.srcdoc=c.html||'';
  focus.root.classList.add('active');
  document.body.style.overflow='hidden';
}
focus.close.onclick=()=>{
  focus.root.classList.remove('active');
  focus.frame.srcdoc='';
  document.body.style.overflow='';
};

filePicker.onchange=async (e)=>{
  const f=e.target.files && e.target.files[0];
  if(!f || !pendingKey) return;
  try{
    const text=await f.text();
    const c=cards.find(x=>x.key===pendingKey && !x.deleted);
    if(c){
      c.html=text;
      render();
    }
  }catch(err){
    alert('Gagal membaca file. Pastikan pilih "Semua file" di picker.');
  }finally{
    pendingKey=null;
    filePicker.value='';
  }
};

document.getElementById('refreshAll').onclick=()=>{
  overlay.classList.add('active');
  setTimeout(()=>{ render(); overlay.classList.remove('active'); }, 1000);
};

document.getElementById('addPreview').onclick=()=>{
  const count=cards.filter(c=>!c.deleted).length;
  if(count>=maxCards){ alert('Maximum 10 previews allowed'); return; }
  cards.push({key:crypto.randomUUID(),name:'Preview #'+(count+1),html:'',deleted:false});
  render();
};

render();
</script>
</body>
</html>
